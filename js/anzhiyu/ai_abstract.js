!function(){const{randomNum:n,basicWordCount:i,btnLink:e,key:o,Referer:l,gptName:t,switchBtn:a,mode:r}=GLOBAL_CONFIG.postHeadAiDescription,{title:c,postAI:s,pageFillDescription:d}=GLOBAL_CONFIG_SITE;let y,m=-1,u=!0,f=r,h=0,p=null,g=!1,T=null;const b=document.querySelector(".post-ai-description"),v=b.querySelector(".ai-title .anzhiyufont.anzhiyu-icon-arrow-rotate-right");let E=b.querySelector(".anzhiyu-icon-circle-dot");const k=b.querySelector(".ai-explanation");let L="",I="",M=600,A=0,S=0,q=[],w=0;const G=new IntersectionObserver(e=>{let t=e[0].isIntersecting;u=t,u&&(M=0===A?200:20,q[1]=setTimeout(()=>{S&&(A=0,S=0),0===A&&(k.innerHTML=L.charAt(0)),requestAnimationFrame(B)},M))},{threshold:0}),x=[function(){$("tianli"==f?"我是文章辅助AI: TianliGPT，点击下方的按钮，让我生成本文简介、推荐相关文章等。":`我是文章辅助AI: ${t} GPT，点击下方的按钮，让我生成本文简介、推荐相关文章等。`)},function(){v.click()},function(){A=0,S=1,P(),u=!1,w=0,k.innerHTML="生成中. . .",L="",I="",G.disconnect(),q[2]=setTimeout(()=>{k.innerHTML=function(){let i=document.querySelectorAll(".relatedPosts-list a");if(!i.length){const a=document.querySelector(".card-widget.card-recent-post");if(!a)return"";i=a.querySelectorAll(".aside-list-item a");let n="";for(let t=0;t<i.length;t++){const e=i[t];n+=`<div class="ai-recommend-item"><span class="index">${t+1}：</span><a href="javascript:;" onclick="pjax.loadUrl('${e.href}')" title="${e.title}" data-pjax-state="">${e.title}</a></div>`}return`很抱歉，无法找到类似的文章，你也可以看看本站最新发布的文章：<br /><div class="ai-recommend">${n}</div>`}let a="";for(let t=0;t<i.length;t++){const e=i[t];a+=`<div class="ai-recommend-item"><span>推荐${t+1}：</span><a href="javascript:;" onclick="pjax.loadUrl('${e.href}')" title="${e.title}" data-pjax-state="">${e.title}</a></div>`}return`推荐文章：<br /><div class="ai-recommend">${a}</div>`}()},600)},function(){$("正在前往博客主页...",!1),q[2]=setTimeout(()=>{window.pjax?pjax.loadUrl("/"):location.href=location.origin},1e3)}],C=b.querySelectorAll(".ai-btn-item");function B(e){if(u)if(B.start||(B.start=e),w=e-B.start,w>=20){if(B.start=e,A<I-1){let e=L.charAt(A+1),t=/[,.，。!?！？]/.test(e)?150:20;k.firstElementChild&&k.removeChild(k.firstElementChild),k.innerHTML+=e;let n=document.createElement("div");n.className="ai-cursor",k.appendChild(n),A++,150===t&&(b.querySelector(".ai-explanation .ai-cursor").style.opacity="0.2"),A===I-1&&(G.disconnect(),k.removeChild(k.firstElementChild)),q[0]=setTimeout(()=>{requestAnimationFrame(B)},t)}}else requestAnimationFrame(B)}function P(){q.length&&q.forEach(e=>{e&&clearTimeout(e)})}function $(e,t=!0){A=0,S=1,P(),u=!1,w=0,G.disconnect(),k.innerHTML=t?"生成中. . .":"请等待. . .",L=e,I=L.length,G.observe(b)}async function j(e=i){"tianli"===f?await async function(e){A=0,S=1,P(),u=!1,w=0,G.disconnect(),e=Math.max(10,Math.min(2e3,e));const t={key:o,Referer:l},i=(c+d).trim().substring(0,e),n={key:t.key,content:i,url:location.href},a={method:"POST",headers:{"Content-Type":"application/json",Referer:t.Referer},body:JSON.stringify(n)};console.info(i.length);try{let e,t=null;t&&clearInterval(t),t=setInterval(()=>{const e="生成中"+".".repeat(S);k.innerHTML=e,S=S%3+1},500);const i=await fetch("https://summary.tianli0.top/",a);let n;n=403===i.status?{summary:"403 refer与key不匹配。"}:500===i.status?{summary:"500 系统内部错误"}:await i.json(),e=n.summary.trim(),T=n.id,setTimeout(()=>{v.style.opacity="1"},300),$(e||"摘要获取失败!!!请检查Tianli服务是否正常!!!"),clearInterval(t)}catch(e){console.error(e),k.innerHTML="发生异常"+e}}(e):function(){const t=s.split(",").map(e=>e.trim());if(1!==t.length){let e=Math.floor(Math.random()*t.length);for(;e===m;)e=Math.floor(Math.random()*t.length);m=e,$(t[e])}else $(t[0]);setTimeout(()=>{v.style.opacity="1"},600)}()}Array.from(C).filter(e=>"go-tianli-blog"!==e.id).forEach((e,t)=>{e.addEventListener("click",()=>{x[t]()})}),document.getElementById("ai-tag").addEventListener("click",function(){"tianli"===f?(b.querySelectorAll(".ai-btn-item").forEach(e=>e.style.display="none"),document.getElementById("go-tianli-blog").style.display="block",$("你好，我是Tianli开发的摘要生成助理TianliGPT，是一个基于GPT-4的生成式AI。我在这里只负责摘要的预生成和显示，你无法与我直接沟通，如果你也需要一个这样的AI摘要接口，可以在下方购买。")):(b.querySelectorAll(".ai-btn-item").forEach(e=>e.style.display="block"),document.getElementById("go-tianli-blog").style.display="none",$(`你好，我是本站摘要生成助理${t} GPT，是一个基于GPT-4的生成式AI。我在这里只负责摘要的预生成和显示，你无法与我直接沟通。`))}),v.addEventListener("click",function(){const t=(c+d).trim().substring(0,i);if(v.style.opacity="0.2",v.style.transitionDuration="0.3s",v.style.transform="rotate("+360*h+"deg)",t.length<=i){let e=t.length-Math.floor(Math.random()*n);for(;e===y||t.length-e===y;)e=t.length-Math.floor(Math.random()*n);y=e,j(e)}else{let e=Math.floor(Math.random()*n)+i;for(;e===y||t.length-e===y;)e=Math.floor(Math.random()*n)+i;j(e)}h++}),document.getElementById("go-tianli-blog").addEventListener("click",()=>{window.open(e,"_blank")}),E.addEventListener("click",async function(){if(!T)return void anzhiyu.snackbarShow("摘要还没加载完呢，请稍后。。。");if(E=b.querySelector(".anzhiyu-icon-circle-dot"),E.style.opacity="0.2",p&&!g)return p.pause(),g=!0,E.style.opacity="1",E.style.animation="",void(E.style.cssText="animation: ''; opacity: 1;cursor: pointer;");if(p&&g)return p.play(),g=!1,void(E.style.cssText="animation: breathe .5s linear infinite; opacity: 0.2;cursor: pointer");const e={key:o,Referer:l},t=new URLSearchParams({key:e.key,id:T}),n={method:"GET",headers:{"Content-Type":"application/json",Referer:e.Referer}};try{const e=await fetch(`https://summary.tianli0.top/audio?${t}`,n);if(403===e.status)console.error("403 refer与key不匹配。");else if(500===e.status)console.error("500 系统内部错误");else{const t=await e.blob(),n=URL.createObjectURL(t);p=new Audio(n),p.play(),E.style.cssText="animation: breathe .5s linear infinite; opacity: 0.2;cursor: pointer",p.addEventListener("ended",()=>{p=null,E.style.opacity="1",E.style.animation=""})}}catch(e){console.error("请求发生错误❎")}}),a&&document.getElementById("ai-Toggle").addEventListener("click",function(){f="tianli"===f?"local":"tianli","tianli"===f?(document.getElementById("ai-tag").innerHTML="TianliGPT",E.style.opacity="1",E.style.cursor="pointer"):(E.style.opacity="0",E.style.cursor="auto",(document.getElementById("go-tianli-blog").style.display="block")&&(document.querySelectorAll(".ai-btn-item").forEach(e=>e.style.display="block"),document.getElementById("go-tianli-blog").style.display="none"),document.getElementById("ai-tag").innerHTML=t+" GPT");j()}),j(),document.getElementById("ai-tag").innerHTML="tianli"===f?"TianliGPT":t+" GPT"}();